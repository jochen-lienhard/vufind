<?
  // Set up page title:
  $lookfor = $this->results->getUrlQuery()->isQuerySuppressed() ? '' : $this->params->getDisplayQuery();
  if (isset($this->overrideTitle)) {
      $this->headTitle($this->overrideTitle);
  } else {
      $this->headTitle($this->translate('Search Results') . (empty($lookfor) ? '' : " - {$lookfor}"));
  }

  // Set up search box:
  $this->layout()->searchbox = $this->context($this)->renderInContext(
      'search/searchbox.phtml',
      array(
        'lookfor' => $lookfor,
        'searchIndex' => $this->params->getSearchHandler(),
        'searchType' => $this->params->getSearchType(),
        'searchId' => $this->results->getSearchId(),
        'searchClassId' => $this->params->getsearchClassId(),
        'checkboxFilters' => $this->params->getCheckboxFacets(),
        'filterList' => $this->params->getFilters(),
        'hasDefaultsApplied' => $this->params->hasDefaultsApplied(),
        'selectedShards' => $this->params->getSelectedShards()
      )
  );

  // Set up breadcrumbs:
  if (isset($this->overrideTitle)) {
    $this->layout()->breadcrumbs .= '<li class="active">' . $this->escapeHtml($this->overrideTitle) . '</li>';
  } else {
    $this->layout()->breadcrumbs .= '<li class="active">' . $this->transEsc('Search') . ': ' . $this->escapeHtml($lookfor) . '</li>';
  }

  // Enable cart if appropriate:
  $this->showCartControls = $this->params->getOptions()->supportsCart() && $this->cart()->isActive();
  // Enable bulk options if appropriate:
  $this->showBulkOptions = $this->params->getOptions()->supportsCart() && $this->showBulkOptions;

  // Load Javascript only if list view parameter is NOT full:
  if ($this->params->getOptions()->getListViewOption()!="full") {
     $this->headScript()->appendFile("full_view.js");
  }

  // Load Javascript dependencies into header:
  $this->headScript()->appendFile("check_item_statuses.js");
  $this->headScript()->appendFile("check_save_statuses.js");
  
  
  $searchClassId = $this->params->getsearchClassId();
  $options = $this->searchOptions($this->searchClassId);
  $searchHome = $options->getSearchHomeAction();
  $advSearch = $options->getAdvancedSearchAction();
  $searchId = $this->results->getSearchId();

$recordTotal = $this->results->getResultTotal();
?>

<div class="row">
    <div class="hidden-print search-controls row">

      <div class="result-count col-xs-12">
        <span><?=$this->transEsc('RDS_SEARCH_TERMS')?> <span class="search-word"><?=$this->escapeHtml($lookfor)?></span>
      </div>

      <div class="col-xs-3">
        <? if ($recordTotal > 0): ?>

          <?=$this->paginationControl($this->results->getPaginator()->setPageRange(2), 'Sliding', 'search/pagination.phtml', array('results' => $this->results))?>

        <? else: ?>
          <p class="lead"><?=$this->transEsc('nohit_heading')?></p>
        <? endif; ?>
<? /*
        <? if ($this->searchType == 'advanced'): ?>
          <p class="adv_search_links">
              <a href="<?=$this->url($advSearch)?>?edit=<?=$this->escapeHtmlAttr($searchId)?>"><?=$this->transEsc("Edit this Advanced Search")?></a> |
              <a href="<?=$this->url($advSearch)?>"><?=$this->transEsc("Start a new Advanced Search")?></a> |
              <a href="<?=$this->url($searchHome)?>"><?=$this->transEsc("Start a new Basic Search")?></a>
          </p>
        <? endif; ?>
*/ ?>
      </div>

      <div class="col-xs-3">
        <?=$this->transEsc("RDS_MEDIEN")?>
          <strong><?=$this->localizedNumber($this->results->getStartRecord())?></strong> - <strong><?=$this->localizedNumber($this->results->getEndRecord())?></strong>
          <? if (!isset($this->skipTotalCount)): ?>
            <?=$this->transEsc('of')?> <strong><?=$this->localizedNumber($recordTotal)?></strong>
          <? endif; ?>
          <!--
          <? if (isset($this->overrideSearchHeading)): ?>
            <?=$this->overrideSearchHeading?>
          <? elseif ($this->params->getSearchType() == 'basic'): ?>
            <?=$this->transEsc('for search')?>: <strong>'<?=$this->escapeHtml($lookfor)?>'</strong>,
          <? endif; ?>
          <? if ($qtime = $this->results->getQuerySpeed()): ?>
            <?=$this->transEsc('query time')?>: <?=$this->localizedNumber($qtime, 2).$this->transEsc('seconds_abbrev')?>
          <? endif; ?>
          -->
          
      </div>

      <div class="col-xs-2">
          <?=$this->render('search/controls/limit.phtml')?>
      </div>

      <div class="col-xs-4 text-right">
          <?=$this->render('search/controls/sort.phtml')?>
      </div>
    </div>
    <? /* End Listing Options */ ?>
</div>

<div class="row">

  <div class="<?=$this->layoutClass('mainbody')?>">
    <? if ($recordTotal > 0): // only display these at very top if we have results ?>
      <? foreach ($this->results->getRecommendations('top') as $current): ?>
        <?=$this->recommend($current)?>
      <? endforeach; ?>
    <? endif; ?>
    <?=$this->flashmessages()?>
    



    <? if ($recordTotal < 1): ?>
      <p>
        <? if (isset($this->overrideEmptyMessage)): ?>
          <?=$this->overrideEmptyMessage?>
        <? else: ?>
          <?=$this->transEsc('nohit_prefix')?> - <strong><?=$this->escapeHtml($lookfor)?></strong> - <?=$this->transEsc('nohit_suffix')?>
        <? endif; ?>
      </p>
      <? if (isset($this->parseError)): ?>
        <p class="alert alert-danger"><?=$this->transEsc('nohit_parse_error')?></p>
      <? endif; ?>
      <? foreach (($top = $this->results->getRecommendations('top')) as $current): ?>
        <?=$this->recommend($current)?>
      <? endforeach; ?>
      <? foreach ($this->results->getRecommendations('noresults') as $current): ?>
        <? if (!in_array($current, $top)): ?>
          <?=$this->recommend($current)?>
        <? endif; ?>
      <? endforeach; ?>
    <? else: ?>
      <form class="form-inline" method="post" name="bulkActionForm" action="<?=$this->url('cart-home')?>">
        
		<div class="search-results-listing iterating-list">
      <?=$this->render('search/list-' . $this->params->getView() . '.phtml')?>
		</div>
        <?=$this->paginationControl($this->results->getPaginator(), 'Sliding', 'search/pagination.phtml', array('results' => $this->results))?>
      </form>
    <? endif; ?>
  </div>
  <? /* End Main Listing */ ?>


  <? if ($recordTotal > 0): ?>
      <? /* Narrow Search Options */ ?>
      <div class="<?=$this->layoutClass('sidebar')?> sidebar-results ">
      
        <div class="sidebar-link">
          <?if ($this->auth()->isLoggedIn()): ?>
            <a href="<?=$this->url('myresearch-home') ?>"><?=$this->transEsc('RDS_RDSFavorites')?> <i class="fa fa-arrow-right"></i></a>
          <?else: ?>
            <? $cart = $this->cart(); if ($cart->isActive()): ?>
                <a id="cartItems" class="modal-link" title="<?=$this->transEsc('RDS_RDSFavorites')?>" href="<?=$this->url('cart-home')?>"><?=$this->transEsc('RDS_RDSFavorites')?> (<strong><?=count($cart->getItems())?></strong>)</a>
            <? endif; ?>
        <?endif; ?>
        </div>
        <div class="sidebar-link">
          <a href="<?=$this->url('home') ?>Search/History"><?=$this->transEsc('RDS_RDSHistory')?> <i class="fa fa-arrow-right"></i></a>
        </div>
      
        <div class="sidebar-recommendations">
            <? foreach ($this->results->getRecommendations('side') as $current): ?>
              <?=$this->recommend($current)?>
            <? endforeach; ?>
        </div>
      </div>
      <? /* End Narrow Search Options */ ?>
  <?endif; ?>
</div>
