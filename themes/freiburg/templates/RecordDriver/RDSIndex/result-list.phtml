<?
  $dataView = $this->params->getOptions()->getListViewOption();
?>

<div class="<?=$this->driver->supportsAjaxStatus()?'ajaxItem ':''?>col-xs-12">
  
    <div class="col-xs-1">
      <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="title getFull" data-view="<?=$dataView ?>">+</a>
      <?=str_replace('class="', 'class="label label-info ', $this->record($this->driver)->getMedienicon())?>
    </div>

    <div class="col-xs-10">
              <? if('full' != $dataView): ?>
                <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="title getFull" data-view="<?=$dataView ?>">
                  <?=$this->RDSIndexRecord($this->driver)->getTitleHtml()?>
                </a>
                <div class="loading hidden">
                  <i class="fa fa-spin fa-spinner"></i> <?=$this->transEsc("Loading")?>...
                </div>
                <div class="short-view<?=$this->driver->supportsAjaxStatus() ? ' ajaxItem' : '' ?>">
              <? endif; ?>
                  <!-- beginn short view content -->
                  <div class="row">
                    <div>
                      <input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getUniqueID())?>" class="hiddenId" />
                      <input type="hidden" value="<?=$this->escapeHtmlAttr($this->driver->getResourceSource())?>" class="hiddenSource" />
                    </div>
                    
                    <? if ($cover = $this->record($this->driver)->getCover('result-list', 'medium', $this->recordLink()->getUrl($this->driver))): ?>
                      <div class="col-sm-2 col-xs-3 left"><?=$cover ?></div>
                    <? endif ?>
                    <div class="<?=$cover ? 'col-sm-7 col-xs-6' : 'col-sm-9 col-xs-9'?> middle">
                      <? if('full' == $dataView): ?>
                        <div>
                          <a href="<?=$this->recordLink()->getUrl($this->driver)?>" class="title">
                            <?=$this->RDSIndexRecord($this->driver)->getTitleHtml()?>
                          </a>
                        </div>
                      <? endif; ?>
                    <div>
                        <? $au_short = $this->driver->getShortAuthors(); ?>
                        <? if (isset($au_short) && !empty($au_short)): ?>
                        <? $i = 0; foreach ($au_short as $field): ?>
                        <?=($i++ == 0)?'':' ; '?>
                          <?=$this->escapeHtml($field)?>
                        <? endforeach; ?>
                        
                        <? else: ?>
                          <? $co_display = $this->driver->getCorporation(); ?>
                          <? if (isset($co_display) && !empty($co_display)): ?>
                            <? $i = 0; foreach ($co_display as $field): ?><?=($i++ == 0)?'':'<br />'?>
                              <?=$this->escapeHtml($field['link'])?>
                            <? endforeach; ?>
                          <? else: ?>
                            <? $pp = $this->driver->getPublisher() ?>
                            <? if (isset($pp) && !empty($pp)): ?>
                              [<?=$this->escapeHtml($pp)?>]
                            <? endif; ?>
                          <? endif; ?>
                        <? endif; ?>
                        <? $py = $this->driver->getPublishingYear(); ?>
                        <? $summpy = $this->driver->getPy(); ?>
                        <? if (isset($py) && !empty($py)): ?>
                          <? if ( !empty($summpy) && $summpy != '0' && $summpy != '9999'): ?>
                          <?=$this->escapeHtml($py)?>
                          <? endif; ?>
                        <? endif; ?>
                    </div>
                
                    <div>
                         <?  /* TODO if 21 100 31 */ ?>
                         <? $shortLink = $this->driver->getShortLinks(); ?>
                         <div class="col-sm-3 rds_shortlink middle">
                         <? if (isset($shortLink) && !empty($shortLink)): ?>
                          <a href="<?=$this->escapeHtml($shortLink) ?>" target="_blank"> &rarr; <?=$this->transEsc('RDS_FULLTEXT_LINK') ?> </a>
                         <? endif; ?>
                         </div>
                         <?  /* TODO End  if 21 100 31 */ ?>
                    </div>
                
                      <? if(!$this->driver->isCollection()): ?>
                        <? if ($snippet = $this->driver->getHighlightedSnippet()): ?>
                          <? if (!empty($snippet['caption'])): ?>
                            <strong><?=$this->transEsc($snippet['caption']) ?>:</strong> ';
                          <? endif; ?>
                          <? if (!empty($snippet['snippet'])): ?>
                            <span class="quotestart">&#8220;</span>...<?=$this->highlight($snippet['snippet']) ?>...<span class="quoteend">&#8221;</span><br/>
                          <? endif; ?>
                        <? endif; ?>
                      <? endif; ?>
                
                      <?
                      /* Display information on duplicate records if available */
                      if ($dedupData = $this->driver->getDedupData()): ?>
                        <div class="dedupInformation">
                        <?
                          $i = 0;
                          foreach ($dedupData as $source => $current) {
                            if (++$i == 1) {
                              ?><span class="currentSource"><a href="<?=$this->recordLink()->getUrl($this->driver)?>"><?=$this->transEsc("source_$source", array(), $source)?></a></span><?
                            } else {
                              if ($i == 2) {
                                ?> <span class="otherSources">(<?=$this->transEsc('Other Sources')?>: <?
                              } else {
                                ?>, <?
                              }
                              ?><a href="<?=$this->recordLink()->getUrl($current['id'])?>"><?=$this->transEsc("source_$source", array(), $source)?></a><?
                            }
                          }
                          if ($i > 1) {
                            ?>)</span><?
                          }?>
                        </div>
                      <? endif; ?>
                
                      <div class="callnumAndLocation ajax-availability hidden">
                        <? if ($this->driver->supportsAjaxStatus()): ?>
                          <strong class="hideIfDetailed"><?=$this->transEsc('Call Number')?>:</strong>
                          <span class="callnumber ajax-availability hidden">
                            <?=$this->transEsc('Loading')?>...<br/>
                          </span>
                          <strong><?=$this->transEsc('Located')?>:</strong>
                          <span class="location ajax-availability hidden">
                            <?=$this->transEsc('Loading')?>...
                          </span>
                          <div class="locationDetails"></div>
                        <? else: ?>
                          <? $summCallNo = $this->driver->getCallNumber(); if (!empty($summCallNo)): ?>
                            <strong><?=$this->transEsc('Call Number')?>:</strong> <?=$this->escapeHtml($summCallNo)?>
                          <? endif; ?>
                        <? endif; ?>
                      </div>
                
                      <? /* We need to find out if we're supposed to display an OpenURL link ($openUrlActive),
                            but even if we don't plan to display the link, we still want to get the $openUrl
                            value for use in generating a COinS (Z3988) tag -- see bottom of file.
                          */
                        $openUrl = $this->openUrl($this->driver, 'results');
                        $openUrlActive = $openUrl->isActive();
                        // Account for replace_other_urls setting
                        $urls = $this->record($this->driver)->getLinkDetails($openUrlActive);
                
                        if ($openUrlActive || !empty($urls)): ?>
                        <? if ($openUrlActive): ?>
                          <br/>
                          <?=$openUrl->renderTemplate()?>
                        <? endif; ?>
                        <? if (!is_array($urls)) $urls = array();
                          if(!$this->driver->isCollection()):
                            foreach ($urls as $current): ?>
                              <a href="<?=$this->escapeHtmlAttr($this->proxyUrl($current['url']))?>" class="fulltext" target="new"><i class="fa fa-external-link"></i> <?=($current['url'] == $current['desc']) ? $this->transEsc('Get full text') : $this->escapeHtml($current['desc'])?></a><br/>
                          <? endforeach; ?>
                        <? endif; ?>
                      <? endif; ?>
                
                      <? if (!$openUrlActive && empty($urls) && $this->driver->supportsAjaxStatus()): ?>
                        <span class="status ajax-availability hidden">
                          <span class="label label-default"><?=$this->transEsc('Loading')?>...</span>
                        </span>
                      <? endif; ?>
                      <?=$this->record($this->driver)->getPreviews()?>
                    </div>
                    <div class="col-xs-3 right hidden-print">
                      <? /* Display qrcode if appropriate: */ ?>
                      <? if ($QRCode = $this->record($this->driver)->getQRCode("results")): ?>
                        <?
                          // Add JS Variables for QrCode
                          $this->jsTranslations()->addStrings(array('qrcode_hide' => 'qrcode_hide', 'qrcode_show' => 'qrcode_show'));
                        ?>
                        <span class="hidden-xs">
                          <i class="fa fa-fw fa-qrcode"></i> <a href="<?=$this->escapeHtmlAttr($QRCode);?>" class="qrcodeLink"><?=$this->transEsc('qrcode_show')?></a>
                          <div class="qrcode hidden">
                            <script type="text/template" class="qrCodeImgTag">
                            <img alt="<?=$this->transEsc('QR Code')?>" src="<?=$this->escapeHtmlAttr($QRCode);?>"/>
                        </script>
                          </div><br/>
                        </span>
                      <? endif; ?>
                
                      <? /* Hierarchy tree link */ ?>
                      <? $trees = $this->driver->tryMethod('getHierarchyTrees'); if (!empty($trees)): ?>
                        <? foreach ($trees as $hierarchyID => $hierarchyTitle): ?>
                          <div class="hierarchyTreeLink">
                            <input type="hidden" value="<?=$this->escapeHtmlAttr($hierarchyID)?>" class="hiddenHierarchyId" />
                            <i class="fa fa-fw fa-sitemap"></i>
                            <a class="hierarchyTreeLinkText modal-link" href="<?=$this->recordLink()->getTabUrl($this->driver, 'HierarchyTree')?>?hierarchy=<?=urlencode($hierarchyID)?>#tabnav" title="<?=$this->transEsc('hierarchy_tree')?>">
                              <?=$this->transEsc('hierarchy_view_context')?><? if (count($trees) > 1): ?>: <?=$this->escapeHtml($hierarchyTitle)?><? endif; ?>
                            </a>
                          </div>
                        <? endforeach; ?>
                      <? endif; ?>
                
                      <?=$this->driver->supportsCoinsOpenUrl()?'<span class="Z3988" title="'.$this->escapeHtmlAttr($this->driver->getCoinsOpenUrl()).'"></span>':''?>
                    </div>
                  </div>
                  
              <? if('full' != $dataView): ?>
                </div> <!-- short view end -->
                
                <div class="long-view hidden"></div>
              <? endif; ?>
  </div>
  
  <div class="col-xs-1">
      <? if ($this->userlist()->getMode() !== 'disabled'): ?>
          <? /* Add to favorites */ ?>
          <? if($this->auth()->isLoggedIn()): ?> 
            <a href="<?=$this->recordLink()->getActionUrl($this->driver, 'Save')?>" class="fa fa-star save-record modal-link" id="<?=$this->driver->getUniqueId() ?>" title="<?=$this->transEsc('Add to favorites')?>"></a>
          <?else: ?>
          <a href="<?=$this->recordLink()->getActionUrl($this->driver, 'Save')?>" data-id="<?=$this->driver->getResourceSource()?>|<?=$this->driver->getUniqueID()?>" class="fa fa-star addItemToCart" id="<?=$this->driver->getUniqueId() ?>" title="<?=$this->transEsc('Add to favorites')?>"></a>
          <?endif; ?>
          <a href="/Cart/doExport" class="fa fa-print doExportRecord" data-id="<?=$this->driver->getResourceSource()?>|<?=$this->driver->getUniqueID()?>"></a>
          <a href="/link?id=<?=$this->driver->getUniqueID()?>" class="fa fa-bookmark"></a>
      <? endif; ?>
    </div>
  
</div>
